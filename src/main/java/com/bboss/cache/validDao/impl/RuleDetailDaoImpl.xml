<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bboss.cache.validDao.interfaces.IRuleDetailDao">
    <resultMap id="BaseResultMap" type="com.bboss.cache.bean.valid.RuleDetail">
        <result column="ID" jdbcType="VARCHAR" property="id"/>
        <result column="OFFER_NUM" jdbcType="VARCHAR" property="offerNum"/>
        <result column="PACKAGE_NUM" jdbcType="VARCHAR" property="packageNum"/>
        <result column="SKU_NUM" jdbcType="VARCHAR" property="skuNum"/>
        <result column="BUSINESS_NUM" jdbcType="VARCHAR" property="businessNum"/>
        <result column="COMBINATIONKEY" jdbcType="VARCHAR" property="combinationKey"/>
        <result column="RULE_NUM" jdbcType="VARCHAR" property="ruleNum"/>
        <result column="RULE_NAME" jdbcType="VARCHAR" property="ruleName"/>
        <result column="RULE_DESC" jdbcType="VARCHAR" property="ruleDesc"/>
        <result column="RULE_MODE" jdbcType="VARCHAR" property="ruleMode"/>
        <result column="RULE_ENTRY" jdbcType="VARCHAR" property="ruleEntry"/>
        <result column="RULE_CONTENT" jdbcType="VARCHAR" property="ruleContent"/>
        <result column="RULE_TYPE" jdbcType="VARCHAR" property="ruleType"/>
        <result column="CHECK_TYPE" jdbcType="VARCHAR" property="checkType"/>
        <result column="RULE_STATUS" jdbcType="VARCHAR" property="ruleStatus"/>
        <result column="RULE_LABEL" jdbcType="VARCHAR" property="ruleLabel"/>
        <result column="RULE_DIRECTORY" jdbcType="VARCHAR" property="ruleDirectory"/>
        <result column="RULE_EXECUTE_SORT" jdbcType="VARCHAR" property="ruleExecuteSort"/>
        <result column="SYSTEM_NUM" jdbcType="VARCHAR" property="systemNum"/>
        <result column="BUSINESS_TYPE" jdbcType="VARCHAR" property="businessType"/>
        <result column="BUSINESS_SCENE" jdbcType="VARCHAR" property="businessScene"/>
        <result column="DESCRIPTION" jdbcType="VARCHAR" property="description"/>
        <result column="CREATE_NUM" jdbcType="VARCHAR" property="createNum"/>
        <result column="CREATE_TIME" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="UPDATE_NUM" jdbcType="VARCHAR" property="updateNum"/>
        <result column="UPDATE_TIME" jdbcType="TIMESTAMP" property="updateTime"/>
    </resultMap>

    <sql id="Base_Column_List">
        ID,
        OFFER_NUM,
        PACKAGE_NUM,
        SKU_NUM,
        BUSINESS_NUM,
        COMBINATIONKEY,
        RULE_NUM,
        RULE_NAME,
        RULE_DESC,
        RULE_MODE,
        RULE_ENTRY,
        RULE_CONTENT,
        RULE_TYPE,
        CHECK_TYPE,
        RULE_STATUS,
        RULE_LABEL,
        RULE_DIRECTORY,
        RULE_EXECUTE_SORT,
        SYSTEM_NUM,
        BUSINESS_TYPE,
        BUSINESS_SCENE,
        DESCRIPTION,
        CREATE_NUM,
        UPDATE_NUM
    </sql>

    <insert id="insert" parameterType="com.bboss.cache.bean.valid.RuleDetail">
        insert into rule_detail (<include refid="Base_Column_List"/>)
        values (
                #{id}, #{offerNum}, #{packageNum}, #{skuNum}, #{businessNum},
                #{combinationKey}, #{ruleNum}, #{ruleName}, #{ruleDesc}, #{ruleMode},
                #{ruleEntry}, #{ruleContent}, #{ruleType}, #{checkType}, #{ruleStatus}, #{ruleLabel},
                #{ruleDirectory}, #{ruleExecuteSort}, #{systemNum}, #{businessType}, #{businessScene},
                #{description}, #{createNum}, #{updateNum}
               )
    </insert>

    <insert id="batchInsert" parameterType="com.bboss.cache.bean.valid.RuleDetail">
        insert into rule_detail (<include refid="Base_Column_List"/>) values
        <foreach collection="list" item="item" index="index" separator=",">
            (
            #{item.id}, #{item.offerNum}, #{item.packageNum}, #{item.skuNum}, #{item.businessNum},
            #{item.combinationKey}, #{item.ruleNum}, #{item.ruleName}, #{item.ruleDesc}, #{item.ruleMode},
            #{item.ruleEntry}, #{item.ruleContent}, #{item.ruleType}, #{item.checkType}, #{item.ruleStatus}, #{item.ruleLabel},
            #{item.ruleDirectory}, #{item.ruleExecuteSort}, #{item.systemNum}, #{item.businessType}, #{item.businessScene},
            #{item.description}, #{item.createNum}, #{item.updateNum}
            )
        </foreach>
    </insert>

    <select id="getOfferRuleGroup" resultType="java.lang.String">
        select offer_num from rule_detail where offer_num is not null group by offer_num
    </select>

    <resultMap id="BaseResultMapWithScript" type="com.bboss.cache.bean.valid.RuleDetail">
        <result column="ID" jdbcType="VARCHAR" property="id"/>
        <result column="OFFER_NUM" jdbcType="VARCHAR" property="offerNum"/>
        <result column="PACKAGE_NUM" jdbcType="VARCHAR" property="packageNum"/>
        <result column="SKU_NUM" jdbcType="VARCHAR" property="skuNum"/>
        <result column="BUSINESS_NUM" jdbcType="VARCHAR" property="businessNum"/>
        <result column="COMBINATIONKEY" jdbcType="VARCHAR" property="combinationKey"/>
        <result column="RULE_NUM" jdbcType="VARCHAR" property="ruleNum"/>
        <result column="RULE_NAME" jdbcType="VARCHAR" property="ruleName"/>
        <result column="RULE_DESC" jdbcType="VARCHAR" property="ruleDesc"/>
        <result column="RULE_MODE" jdbcType="VARCHAR" property="ruleMode"/>
        <result column="RULE_ENTRY" jdbcType="VARCHAR" property="ruleEntry"/>
        <result column="RULE_CONTENT" jdbcType="VARCHAR" property="ruleContent"/>
        <result column="RULE_TYPE" jdbcType="VARCHAR" property="ruleType"/>
        <result column="CHECK_TYPE" jdbcType="VARCHAR" property="checkType"/>
        <result column="RULE_STATUS" jdbcType="VARCHAR" property="ruleStatus"/>
        <result column="RULE_LABEL" jdbcType="VARCHAR" property="ruleLabel"/>
        <result column="RULE_DIRECTORY" jdbcType="VARCHAR" property="ruleDirectory"/>
        <result column="RULE_EXECUTE_SORT" jdbcType="VARCHAR" property="ruleExecuteSort"/>
        <result column="SYSTEM_NUM" jdbcType="VARCHAR" property="systemNum"/>
        <result column="BUSINESS_TYPE" jdbcType="VARCHAR" property="businessType"/>
        <result column="BUSINESS_SCENE" jdbcType="VARCHAR" property="businessScene"/>
        <result column="DESCRIPTION" jdbcType="VARCHAR" property="description"/>
        <result column="CREATE_NUM" jdbcType="VARCHAR" property="createNum"/>
        <result column="CREATE_TIME" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="UPDATE_NUM" jdbcType="VARCHAR" property="updateNum"/>
        <result column="UPDATE_TIME" jdbcType="TIMESTAMP" property="updateTime"/>
        <!-- 关联 ruleDetailScriptList -->
        <collection property="ruleDetailScriptList" column="ID" ofType="com.bboss.cache.bean.valid.RuleDetailScript"
                    select="com.bboss.cache.validDao.interfaces.IRuleDetailScriptDao.queryRuleDetailScriptById"></collection>
    </resultMap>
    <select id="getRuleDetail" resultMap="BaseResultMapWithScript">
        select
        <include refid="Base_Column_List"/>
        from rule_detail
        where rule_status = '1'
        <if test="offerNum != null and offerNum != ''">
            and offer_num = #{offerNum}
        </if>
        <if test="skuNum != null and skuNum != ''">
            and sku_num = #{skuNum}
        </if>
        <if test="businessNum != null and businessNum != ''">
            and business_num = #{businessNum}
        </if>
        order by rule_execute_sort
    </select>

    <delete id="deleteRuleDetailByPackage" parameterType="java.lang.String">
        delete from rule_detail
        where rule_status = '1' and offer_num = #{offerNum}
        <if test="skuNum != null and skuNum != ''">
            and sku_num = #{skuNum}
        </if>
    </delete>
</mapper>
